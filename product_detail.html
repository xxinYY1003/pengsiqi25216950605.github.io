<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>简易购 - 商品详情</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .product-detail {
            max-width: 1000px;
            margin: 50px auto;
        }
    </style>
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-light bg-light sticky-top">
        <div class="container">
            <a class="navbar-brand" href="index.html">简易购</a>
            <div class="navbar-nav ms-auto">
                <a class="nav-link" href="login.html">登录/注册</a>
                <a class="nav-link" href="cart.html">购物车</a>
            </div>
        </div>
    </nav>

    <div class="container product-detail">
        <div class="row" id="productDetail">
            <!-- 商品详情由JS渲染 -->
        </div>
        <div class="mt-4">
            <button class="btn btn-primary" id="addToCartBtn">加入购物车</button>
        </div>
    </div>

    <script>
        // 模拟商品数据
        const productData = [
            { id: 1, name: "智能手表", price: 299, img: "https://picsum.photos/400/400?random=101", desc: "超长续航，心率监测，多运动模式" },
            { id: 2, name: "纯棉T恤", price: 89, img: "https://picsum.photos/400/400?random=102", desc: "100%纯棉，亲肤透气，多款颜色可选" },
            { id: 3, name: "家用加湿器", price: 129, img: "https://picsum.photos/400/400?random=103", desc: "静音运行，大容量水箱，智能恒湿" },
            { id: 4, name: "进口零食礼包", price: 159, img: "https://picsum.photos/400/400?random=104", desc: "多种进口零食组合，送礼自用皆宜" }
        ];

        // 获取URL参数中的商品ID
        const urlParams = new URLSearchParams(window.location.search);
        const productId = urlParams.get('id');
        const product = productData.find(item => item.id == productId);

        // 渲染商品详情
        const productDetail = document.getElementById('productDetail');
        if (product) {
            productDetail.innerHTML = `
                <div class="col-md-6">
                    <img src="${product.img}" class="img-fluid rounded" alt="${product.name}">
                </div>
                <div class="col-md-6">
                    <h3>${product.name}</h3>
                    <p class="fs-4 text-primary mt-3">¥${product.price}</p>
                    <p class="mt-3">商品描述：${product.desc}</p>
                    <div class="mt-4">
                        <label class="me-2">数量：</label>
                        <input type="number" id="productQuantity" value="1" min="1" class="form-control w-25 d-inline-block">
                    </div>
                </div>
            `;
        } else {
            productDetail.innerHTML = '<div class="col-12 text-center">商品不存在</div>';
            document.getElementById('addToCartBtn').disabled = true;
        }

        // 加入购物车功能
        const addToCartBtn = document.getElementById('addToCartBtn');
        addToCartBtn.addEventListener('click', () => {
            // 校验登录状态
            const isLogin = localStorage.getItem('isLogin') === 'true';
            if (!isLogin) {
                if (confirm('请先登录！是否跳转到登录页？')) {
                    window.location.href = 'login.html';
                }
                return;
            }

            if (!product) return;
            const quantity = parseInt(document.getElementById('productQuantity').value) || 1;
            
            // 获取购物车数据
            let cart = JSON.parse(localStorage.getItem('cart')) || [];
            const existItem = cart.find(item => item.id == product.id);

            if (existItem) {
                // 商品已存在，增加数量
                existItem.quantity += quantity;
            } else {
                // 新增商品到购物车
                cart.push({
                    id: product.id,
                    name: product.name,
                    price: product.price,
                    img: product.img,
                    quantity: quantity
                });
            }

            // 保存购物车数据
            localStorage.setItem('cart', JSON.stringify(cart));
            alert('加入购物车成功！');
        });
    </script>
</body>
</html>